# 🖥 Section 4. 데드락 (Deadlock)

## 📍 데드락이란? (feat.식사하는 철학자)
- `교착 상태 (Deadlock)` : 여러 프로세스가 서로 다른 프로세스의 작업이 끝나기를 기다리다가 어떤 프로세스도 작업을 끝내지 못하는 상태
- 만약 자원을 여러 개의 프로세스가 공유하지 않는다면 교착상태가 발생하지 않지만, 실제로는 그렇지 않다.
- "식사하는 철학자" 예제
    - 철학자 3명, 포크 3개. 음식을 먹으려면 2개의 포크를 집어야 함.
    - 한사람이 포크를 들고 식사, 다른 두명이 기다렸다가 먹으면 문제 X
    - 하지만, 한명씩 포크 하나를 모두 들고 있다면 먹을 수도 없고 남은 포크도 없으므로 교착상태 발생
    
### 교착 상태의 필요 조건
1. 상호 배제
    - 어떤 프로세스가 한 리소스를 점유했다면 그 리소스는 다른 프로세스에게 공유되면 안됨. (= 포크)
2. 비선점
    - 프로세스 A가 리소스를 점유하고 있을때 다른 프로세스가 리소스를 뺏을 수 없음
      (= 다른 철학자가 들고 있는 포크를 뺏을 수 없음)
3. 점유와 대기
    - 어떤 프로세스가 리소스 A를 가지고 있는 상태에서 리소스 B를 기다리고 있는 상태
      (= 한 포크를 들고 있는 상태에서 다른 철학자가 들고 있는 포크를 대기하고 있는 상태)
4. 원형 대기
    - 점유와 대기를 하는 프로세스간의 관계가 원형 대기인 것
      (= 포크를 내러놓기를 기다리고 있는 철학자들간의 관계가 원형인 것)
      
<br>

## 📍 데드락 해결 (feat.은행원 알고리즘)

### 1. 교착 상태 회피 (Deadlock Avoidance)
- 교착 상태가 발생하지 않을 수준의 자원만을 할당하는 방법
- 전체 자원의 수와 할당된 자원의 수를 기준으로 안정상태와 불안정상태로 나눔.
- 불안정 상태에 있더라도 무조건 교착 상태에 빠진 것이 아니라 그럴 위험이 높은 것

#### 은행원 알고리즘
- 사업가들에게 돈을 빌려줄 때 교착 상태에 빠지지 않기 위해 대출 가능한 상황(안전 상태)인지 확인하고 빌려주는 것.
- 운영체제는 프로세스에게 자원을 할당하기 전에 자신에게 부여된 시스템의 총 자원을 미리 파악하고 있어야 함.
- 프로세스들은 자신이 필요한 자원의 최대 숫자 (최대 요구 자원)를 운영체제에게 알려줘야 함.
- `안정 상태` : 시스템의 총 자원, 프로세스들의 최대 요구 자원, 현재 프로세스들에게 할당된 자원, 프로세스들의 요청이 예상되는 자원을 정리했을 때
프로세스에게 사용할 수 있는 사용 가능한 자원으로 프로세스에게 요청이 예상되는 자원에 대한 요청이 들어온 경우 전부 할당이 가능한 상태를 말한다.
  (요청이 예상되는 자원의 최대 개수를 최소 하나의 프로세스에게 할당할 수 있는 상태여야 함)
  
### 2. 교착 상태 검출 방법
1. 가벼운 교착 상태 검출 (타이머)
    - 프로세스가 일정 시간동안 작업을 진행하지 않는다면 교착상태가 발생했다고 간주하고 교착상태를 해결하는 방법
    - 일정 시점마다 체크포인트를 만들어 저장하고, 타이머가 종료됐을 때 일정 체크포인트로 롤백하는 방법을 사용함. 
    
2. 무거운 교착 상태 검출 (자원 할당 그래프)
    - 교착 상태가 검출됐다면 교착 상태가 발생한 프로세스를 강제 종료하고 롤백시킴
    - 지속적으로 프로세스의 상태를 검사해야 하기 때문에 오버헤드 발생 위험이 큼.

<br>