## 📍 도커를 알아야 하는 이유
- 쿠버네티스를 이루고 있는 기술이 컨테이너를 벗어날 수 없기 때문에 컨테이너를 잘 알아야 함. --> 도커 이해 필요 

1. 파드, 컨테이너, 도커, 쿠버네티스의 관계
- 파드는 쿠버네티스로부터 IP를 받아 컨테이너가 외부와 통신할 수 있는 경로를 제공함
- 컨테이너를 돌보는 것이 **파드**, 파드를 돌보는 것이 **쿠버네티스 워커 노드**, 워커 노드를 돌보는 것이 **쿠버네티스 마스터**
- **컨테이너** : 하나의 운영 체제 안에서 커널을 공유하며 개별적인 실행 환경을 제공하는 격리된 공간

2. 다양한 컨테이너 관리 도구
- 컨테이너디 (container-d) : Docker 사에서 컨테이너 런타임 부분을 분리하여 만든 오픈 소스. 
  컨테이너디는 다른 시스템과 통합해 컨테이너를 관리하는 기능을 제공하기 때문에 컨테이너 관리 도구를 직접 개발하려는 개발자에게 적당함.
- 크라이오 (CRI-O) : 레드햇에서 개발해 2019년에는 클라우드 네이티브 컴퓨팅 재단에 기부한 오픈소스 프로젝트로, 아직 자료가 부족함.
- 카타 컨테이너 (Kata Containers) : 오픈스택 제단에서 후원하는 오픈 소스 컨테이너 관리 도구. 
  컨테이너마다 독립적인 커널을 제공한다는 점에서 기존 컨테이너 방식과의 차이가 있음.
- 도커 (Docker) : 사용자가 명령어를 입력하는 명령어 도구와 명령을 받아들이는 도커 데몬으로 구성되어 있음. 
  도커 1.11 이후에는 컨테이너를 제어하기 위해 별도의 컨테이너디를 포함하고 있음.

## 📍 도커로 컨테이너 다루기

1. 이미지의 레이어 구조
   - 이미지는 동일한 레이어를 공유하므로 전체 용량이 감소함.
   - latest와 stable 이미지를 비교했을 때 실제로 69.2MB의 레이어를 두 이미지가 공유하고 있다는 것을 알 수 있었음. 그러므로 도커로 자성된 컨테이너는 레이어를 재사용하기 때문에 여러 이미지를 내려받더라도 효율적으로 디스크 용량을 사용할 수 있음.

> 작동 중인 컨테이너의 설정을 변경할 수 있을까?
- 컨테이너는 **변경 불가능한 인프라(Immutable infrastructure)**를 지향하기 때문에 초기에 인프라를 구성하면 임의로 디렉터리 연결이나 포트 노출과 같은 설정을 변경할 수 없다. 따라서 컨테이너의 설정을 변경하려면 새로운 컨테이너를 생성해야 되며, 이러한 특성은 배포된 상태를 지속적으로 유지시킨다는 장점이 존재한다.

2. 컨테이너의 내부 파일 변경하기
   - `docker cp`
     - docker cp <호스트 경로> <컨테이너 이름> : <컨테이너 내부 경로> 형식.
     - 호스트에 위치한 파일을 구동 중인 컨테이너 내부에 복사. 컨테이너에 저장돼 있는 설정 및 로그를 추출해 확인하는 목적으로도 사용함.
   - `Dockerfile ADD`
     - Dockerfile 기반. Dockerfile에 ADD라는 구문으로 컨테이너 내부로 복사할 파일을 지정하면 이미지를 빌드할 때 지정한 파일이 이미지 내부로 복사됨.
   - `bind mount`
     - 호스트의 파일 시스템과 컨테이너 내부를 연결해 어느 한쪽에서 작업한 내용이 양쪽에 동시에 반영되는 방법.
     - 새로운 컨테이너를 구동할 때에도 호스트와 연결할 파일이나 디렉터리의 경로만 지정하면 다른 컨테이너에 있는 파일을 새로 생성한 컨테이너와 연결할 수 있음.
     - 컨테이너가 바뀌어도 없어지면 안되는 자료를 보관시에 이용
   - `volume`
     - 호스트의 파일 시스템과 컨테이너 내부를 연결하는 것은 바인드 마운트와 동일하지만, 호스트의 특정 디렉터리가 아닌 도커가 관리하는 볼륨을 컨테이너와 연결. NFS등을 이용하면 다른 호스트에서도 도커가 관리하는 볼륨을 함께 사용할 수 있음.

## 📍 4가지 방법으로 컨테이너 이미지 만들기

1. 컨테이너 이미지 생성 방법
    - 기본적인 빌드
    - 용량 줄이기
    - 컨테이너 내부 빌드
    - 멀티 스테이지
2. 기본 방법으로 빌드하기
3. 컨테이너 용량 줄이기
4. 컨테이너 내부 빌드
    - 도커 파일 작성 / 도커 파일 빌드 / 빌드 완료
5. 멀티 스테이지 빌드 (Multi-stage build), 최적화하기
    - 최종 이미지의 용량을 줄일 수 있고 호스트에 어떠한 빌드 도구도 설치할 필요 없음.
    - docker-ce 17.06 버전부터 지원됨.


## 📍 쿠버네티스에서 직접 만든 컨테이너 사용하기

1. 쿠버네티스에서 도커 이미지 구동하기
   - 직접 만든 컨테이너 이미지도 kubectl 명령어로 구동 가능.
2. 레지스트리 구성하기
   - 도커 레지스트리 이미지를 사용해 사설 도커 레지스트리를 만들고 이용할 수 있음.
   - 레지스트리 종류
     - Quay(키)
       - 레드햇에서 제공하는 이미지 레지스트리
       - 무료 버전 / 유료 버전 / 서비스형 상품 등 존재
       - 안정적인 서비스를 운영하고 싶은 사용자에게 적합
     - Harbor(하버)
       - 오픈소스로 제공됨.
       - 도커 이미지와 헬름 차트를 함께 저장할 수 있어 두 가지 모두 사용할 시 적합
     - Nexus Repository(넥서스 리포지터리)
       - 오픈소스로 제공되는 무료 버전 / 유료 버전 존재
       - 여러 형식의 패키지를 하나의 저장소에 관리하려는 사용자에게 안성맞춤
     - Docker Registry(도커 레지스트리)
       - 도커에서 제공하는 레지스트리
       - 도커 이미지만 저장 가능
       - 기능이 매우 간단해 개인용이나 테스트용으로 적합.